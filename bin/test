#!/usr/bin/env bash

echo 'Running buildpack-multi test'

if [[ -f $BUILD_PATH/buildpack-multi-test.sh ]]; then
  BP_MULTI_DIR="1"
else
  BP_MULTI_TEST="0"
fi

for BUILDPACK in $(cat $BUILD_PATH/.buildpacks); do
  if [ "$BP_MULTI_TEST" = "1" ]; then
    echo "Running found $BUILD_PATH/buildpack-multi-test file"
    . $BUILD_PATH/buildpack-multi-test.sh $BUILD_PATH "i" $BUILDPACK
    if [ $? != 0 ]; then
      echo "Running buildpack-multi-test failed"
      exit 1
    fi
  else
    echo "buildpack-multi-test file not found"
  fi
done

if [ "$BP_MULTI_TEST" = "1" ]; then
  . $BUILD_PATH/buildpack-multi-test.sh $BUILD_PATH "f"
fi
