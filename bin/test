#!/usr/bin/env bash

echo 'Running buildpack-multi test'
echo "BPT - $0"
echo "BPT - $1"
echo "BPT - $2"
echo "BPT - $3"

if [[ -f $1/buildpack-multi-test.sh ]]; then
  BP_MULTI_DIR="1"
else
  BP_MULTI_TEST="0"
fi

for BUILDPACK in $(cat $1/.buildpacks); do
  if [ "$BP_MULTI_TEST" = "1" ]; then
    echo "Running found $1/buildpack-multi-test file"
    . $1/buildpack-multi-test.sh $1 "i" $BUILDPACK
    if [ $? != 0 ]; then
      echo "Running buildpack-multi-test failed"
      exit 1
    fi
  else
    echo "buildpack-multi-test file not found"
  fi
done

if [ "$BP_MULTI_TEST" = "1" ]; then
  . $1/buildpack-multi-test.sh $1 "f"
fi
