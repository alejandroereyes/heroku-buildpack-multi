#!/usr/bin/env bash

echo 'Running buildpack-multi test'

dir=/tmp/build

if [[ -f $dir/buildpack-multi-test.sh ]]; then
  BP_MULTI_DIR="1"
else
  BP_MULTI_TEST="0"
fi

for BUILDPACK in $(cat $dir/.buildpacks); do
  if [ "$BP_MULTI_TEST" = "1" ]; then
    echo "Running found $dir/buildpack-multi-test file"
    . $dir/buildpack-multi-test.sh $dir "i" $dir
    if [ $? != 0 ]; then
      echo "Running buildpack-multi-test failed"
      exit 1
    fi
  else
    echo "buildpack-multi-test file not found"
  fi
done

if [ "$BP_MULTI_TEST" = "1" ]; then
  . $dir/buildpack-multi-test.sh $dir "f"
fi
